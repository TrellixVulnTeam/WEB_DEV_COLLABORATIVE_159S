!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).wtfImage=e()}(this,(function(){"use strict";var t={normalize:function(t=""){return t=(t=t.replace(/ /g,"_")).trim(),t=encodeURIComponent(t)},defaults:{lang:"en",path:"w/api.php"},toUrlParams:function(t){return Object.entries(t).map((([t,e])=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`)).join("&")},fetchOne:function(t,e,n){return e(t).then((t=>{let e=Object.keys(t.query.pages||{});return 0===e.length?{pages:[],cursor:null}:{pages:t.query.pages[e[0]][n]||[],cursor:t.continue}}))}};const{normalize:e,defaults:n,toUrlParams:r,fetchOne:o}=t,i={action:"query",rdnamespace:0,prop:"redirects",rdlimit:500,format:"json",origin:"*",redirects:!0},a=function(t,n,o){let a=`https://${n.lang}.wikipedia.org/${n.path}?`;return n.domain&&(a=`https://${n.domain}/${n.path}?`),a+=r(i),a+="&titles="+e(t),o&&(a+=o),a};var c=async function(t,e){let r=[],i=!0,c="";for(;i;){let u=a(t,n,c),{pages:s,cursor:l}=await o(u,e,"redirects");r=r.concat(s),l&&l.rdcontinue?c="&rdcontinue="+l.lhcontinue:i=!1}return r};const{normalize:u,defaults:s,toUrlParams:l,fetchOne:p}=t,f={action:"query",lhnamespace:0,prop:"linkshere",lhshow:"!redirect",lhlimit:500,format:"json",origin:"*",redirects:!0},h=function(t,e,n){let r=`https://${e.lang}.wikipedia.org/${e.path}?`;return e.domain&&(r=`https://${e.domain}/${e.path}?`),r+=l(f),r+="&titles="+u(t),n&&(r+=n),r};var g=async function(t,e){let n=[],r=!0,o="";for(;r;){let i=h(t,s,o),{pages:a,cursor:c}=await p(i,e,"linkshere");n=n.concat(a),c&&c.lhcontinue?o="&lhcontinue="+c.lhcontinue:r=!1}return n};const{normalize:m,defaults:d,toUrlParams:y}=t,w={action:"query",prop:"pageviews",format:"json",origin:"*",redirects:!0};var $=function(t,e){return e(function(t,e,n){let r=`https://${e.lang}.wikipedia.org/${e.path}?`;return e.domain&&(r=`https://${e.domain}/${e.path}?`),r+=y(w),r+="&titles="+m(t),n&&(r+=n),r}(t.title(),d)).then((t=>{let e=Object.keys(t.query.pages||{});return 0===e.length?[]:t.query.pages[e[0]].pageviews||[]}))};const{normalize:v,defaults:j,toUrlParams:b,fetchOne:q}=t,k={action:"query",tinamespace:0,prop:"transcludedin",tilimit:500,format:"json",origin:"*",redirects:!0},O=function(t,e,n){let r=`https://${e.lang}.wikipedia.org/${e.path}?`;return e.domain&&(r=`https://${e.domain}/${e.path}?`),r+=b(k),r+="&titles="+v(t),n&&(r+=n),r};var P=async function(t,e,n){let r=[],o=!0,i="";for(;o;){let e=O(t,j,i),{pages:a,cursor:c}=await q(e,n,"transcludedin");r=r.concat(a),c&&c.ticontinue?i="&ticontinue="+c.ticontinue:o=!1}return r};const{normalize:U,defaults:z,toUrlParams:C}=t,R={action:"query",list:"categorymembers",cmlimit:500,cmtype:"page|subcat",cmnamespace:0,format:"json",origin:"*",redirects:!0},I=function(t,e,n){return e(t).then((t=>{let e=Object.keys(t.query[n]||{});return 0===e.length?{pages:[],cursor:null}:{pages:e.map((e=>t.query[n][e])),cursor:t.continue}}))},_=function(t,e,n){let r=`https://${e.lang}.wikipedia.org/${e.path}?`;return e.domain&&(r=`https://${e.domain}/${e.path}?`),r+=C(R),!1===/^Category/i.test(t)&&(t="Category:"+t),r+="&cmtitle="+U(t),n&&(r+=n),r};var D=async function(t,e,n){let r=[],o=!0,i="";for(;o;){let e=_(t,z,i),{pages:a,cursor:c}=await I(e,n,"categorymembers");r=r.concat(a),c&&c.cmcontinue?i="&cmcontinue="+c.lhcontinue:o=!1}return r};const{defaults:T,toUrlParams:x}=t,E={action:"query",generator:"random",grnnamespace:"0",prop:"pageprops",grnlimit:"1",rvslots:"main",format:"json",origin:"*",redirects:"true"};var L=async function(t,e){let n=function(t){let e=`https://${t.lang}.wikipedia.org/${t.path}?`;return t.domain&&(e=`https://${t.domain}/${t.path}?`),e+=x(E),e}(T);return await function(t,e){return e(t).then((t=>{let e=Object.keys(t.query.pages||{});return 0===e.length?{pages:[],cursor:null}:t.query.pages[e[0]]}))}(n,e)};const{defaults:S,toUrlParams:V}=t,A={format:"json",action:"query",generator:"random",grnnamespace:14,prop:"revisions",grnlimit:1,origin:"*"};var B=function(t={},e){let n=`https://${(t=Object.assign({},S,t)).lang}.wikipedia.org/${t.path}?`;return t.domain&&(n=`https://${t.domain}/${t.path}?`),n+=V(A),e(n).then((t=>{try{let e=t.query.pages;return e[Object.keys(e)[0]].title}catch(t){throw t}})).catch((t=>(console.error(t),null)))},F=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return new Promise((function(r,o){if(t&&e)if(0!==t.length)for(var i=[],a=n-1,c=0,u=function n(u){c+=1;var s=e(t[u]);s.then?(s.then((function(t){i[u]=t})),s.catch((function(t){console.error(t),i[u]=null})),s.finally((function(){c-=1,a+=1,t.length>=a+1?n(a):c<=0&&r(i)}))):o("Error: function must return a promise")},s=t.length<n?t.length:n,l=0;l<s;l+=1)u(l);else r([]);else o("Error: missing required parameters to rate-limit function")}))},G={one:function(t,e){return F(t,e,1)},two:function(t,e){return F(t,e,2)},three:function(t,e){return F(t,e,3)},four:function(t,e){return F(t,e,4)},five:function(t,e){return F(t,e,5)},ten:function(t,e){return F(t,e,10)},fifteen:function(t,e){return F(t,e,15)}};G.serial=G.one,G.linear=G.one,G.crawl=G.three,G.walk=G.five,G.run=G.ten,G.sprint=G.fifteen;var H=G;var J,K=(J=Object.freeze({__proto__:null,default:H}))&&J.default||J;var M=function(t,e,n){var r;t[0]&&((r=t[0])&&"[object Object]"===Object.prototype.toString.call(r))&&(t=t.map((t=>t.title)));let o=function(t,e=5){let n=[];for(let r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n}(t);return K.three(o,(function(t){return n.fetch(t,e)})).then((t=>t.reduce(((t,e)=>t=t.concat(e)))))};return function(t){t.Doc.prototype.getRedirects=function(){return c(this.title(),t.http)},t.Doc.prototype.getIncoming=function(){return g(this.title(),t.http)},t.Doc.prototype.getPageViews=function(){return $(this,t.http)},t.wtf.getRandomPage=function(e){return L(e,t.http)},t.wtf.getRandomCategory=function(e){return B(e,t.http)},t.wtf.getTemplatePages=function(e,n){return P(e,n,t.http)},t.wtf.getCategoryPages=function(e,n){return D(e,n,t.http)},t.wtf.fetchList=function(e,n){return M(e,n,t.wtf)},t.wtf.getIncoming=function(e){return g(e,t.http)},t.wtf.getRedirects=function(e){return c(e,t.http)}}}));
