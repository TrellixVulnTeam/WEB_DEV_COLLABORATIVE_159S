{"version":3,"file":"wtf-plugin-category.js","sources":["../node_modules/slow/builds/slow.mjs","../src/random.js","../src/index.js"],"sourcesContent":["/* slow 1.1.0 MIT */\n//only do foo promises at a time.\nvar rateLimit = function rateLimit(arr, fn) {\n  var limit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 5;\n  return new Promise(function (resolve, reject) {\n    //some validation\n    if (!arr || !fn) {\n      reject('Error: missing required parameters to rate-limit function');\n      return;\n    }\n\n    if (arr.length === 0) {\n      resolve([]);\n      return;\n    }\n\n    var results = [];\n    var n = limit - 1;\n    var pending = 0; //simple recursion, but with then/finally\n\n    var go = function go(i) {\n      pending += 1;\n      var p = fn(arr[i]);\n\n      if (!p.then) {\n        reject('Error: function must return a promise');\n        return;\n      }\n\n      p.then(function (r) {\n        results[i] = r;\n      });\n      p[\"catch\"](function (e) {\n        console.error(e);\n        results[i] = null;\n      });\n      p[\"finally\"](function () {\n        pending -= 1;\n        n += 1; //should we keep going?\n\n        if (arr.length >= n + 1) {\n          go(n);\n        } else if (pending <= 0) {\n          //no more to start - are we the last to finish?\n          resolve(results);\n        }\n      });\n    }; //fire-off first-n items\n\n\n    var init = arr.length < limit ? arr.length : limit;\n\n    for (var i = 0; i < init; i += 1) {\n      go(i);\n    }\n  });\n};\n\nvar rateLimit_1 = rateLimit;\n\nvar methods = {\n  one: function one(arr, fn) {\n    return rateLimit_1(arr, fn, 1);\n  },\n  two: function two(arr, fn) {\n    return rateLimit_1(arr, fn, 2);\n  },\n  three: function three(arr, fn) {\n    return rateLimit_1(arr, fn, 3);\n  },\n  four: function four(arr, fn) {\n    return rateLimit_1(arr, fn, 4);\n  },\n  five: function five(arr, fn) {\n    return rateLimit_1(arr, fn, 5);\n  },\n  ten: function ten(arr, fn) {\n    return rateLimit_1(arr, fn, 10);\n  },\n  fifteen: function fifteen(arr, fn) {\n    return rateLimit_1(arr, fn, 15);\n  }\n};\nmethods.serial = methods.one;\nmethods.linear = methods.one;\nmethods.crawl = methods.three;\nmethods.walk = methods.five;\nmethods.run = methods.ten;\nmethods.sprint = methods.fifteen;\nvar src = methods;\n\nexport default src;\n","const defaults = {\n  lang: 'en',\n  wiki: 'wikipedia',\n  domain: null,\n  path: 'w/api.php' //some 3rd party sites use a weird path\n}\nconst isObject = function (obj) {\n  return obj && Object.prototype.toString.call(obj) === '[object Object]'\n}\n\nconst fetchRandom = function (lang, options, http) {\n  options = options || {}\n  options = Object.assign({}, defaults, options)\n  //support lang 2nd param\n  if (typeof lang === 'string') {\n    options.lang = lang\n  } else if (isObject(lang)) {\n    options = Object.assign(options, lang)\n  }\n\n  let url = `https://${options.lang}.wikipedia.org/${options.path}?`\n  if (options.domain) {\n    url = `https://${options.domain}/${options.path}?`\n  }\n  url += `format=json&action=query&generator=random&grnnamespace=14&prop=revisions&grnlimit=1&origin=*`\n\n  return http(url)\n    .then((res) => {\n      try {\n        let o = res.query.pages\n        let key = Object.keys(o)[0]\n        return o[key].title\n      } catch (e) {\n        throw e\n      }\n    })\n    .catch((e) => {\n      console.error(e)\n      return null\n    })\n}\nmodule.exports = fetchRandom\n","const slow = require('slow')\nconst random = require('./random')\n\nconst chunkBy = function (arr, chunkSize = 5) {\n  let groups = []\n  for (let i = 0; i < arr.length; i += chunkSize) {\n    groups.push(arr.slice(i, i + chunkSize))\n  }\n  return groups\n}\n\nconst fetchCat = function (wtf, cat, lang, opts) {\n  if (!cat) {\n    return { docs: [], categories: [] }\n  }\n  return wtf.category(cat, lang).then((resp) => {\n    let pages = resp.pages.map((o) => o.title)\n    let groups = chunkBy(pages)\n\n    const doit = function (group) {\n      return wtf.fetch(group, opts) //returns a promise\n    }\n    //only allow three requests at a time\n    return slow.three(groups, doit).then((responses) => {\n      //flatten the results\n      let docs = [].concat.apply([], responses)\n      return {\n        docs: docs,\n        categories: resp.categories\n      }\n    })\n  })\n}\n\nconst plugin = function (models) {\n  models.wtf.parseCategory = function (cat, lang, opts) {\n    return fetchCat(models.wtf, cat, lang, opts)\n  }\n  models.wtf.randomCategory = function (lang, opts) {\n    return random(lang, opts, models.http)\n  }\n  models.wtf.fetchCategory = models.wtf.parseCategory\n}\nmodule.exports = plugin\n"],"names":["rateLimit","arr","fn","limit","arguments","length","undefined","Promise","resolve","reject","results","n","pending","go","i","p","then","r","e","console","error","init","rateLimit_1","methods","one","two","three","four","five","ten","fifteen","serial","linear","crawl","walk","run","sprint","src","defaults","lang","wiki","domain","path","isObject","obj","Object","prototype","toString","call","fetchRandom","options","http","assign","url","res","o","query","pages","key","keys","title","catch","chunkBy","chunkSize","groups","push","slice","fetchCat","wtf","cat","opts","docs","categories","category","resp","map","doit","group","fetch","slow","responses","concat","apply","plugin","models","parseCategory","randomCategory","random","fetchCategory"],"mappings":"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"}